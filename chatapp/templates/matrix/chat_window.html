{% load static %}
{% load widget_tweaks %}
<!------ Include the above in your HEAD tag ---------->


<html>
<head>
    <script>var chat_window_url = '{% url 'chat_window' %}'</script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/d3js/5.7.0/d3.min.js"></script>
    <script type="text/javascript" src="{% static 'matrix/chat_window.js' %}"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" type="text/css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'matrix/chat_window.css' %}">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
</head>

<script>
    $( document ).ready(function() {
        //scroll to bottom
        let targetNode = document.querySelector('#msg_history');
        scroll_to_bottom(targetNode);
        let config = { attributes: true, childList: true, subtree: true};
        let observer = new MutationObserver(callback);
        observer.observe(targetNode, config);

        //send room_name to View to load new room
        $(document).on('click', '.active_room', function () {
            let room_name = $(this).attr('id');

            $.ajax({
                url: chat_window_url,
                type: 'get',
                data: {
                    'element': "roomsList",
                    'room_name': room_name
                },
                success: function () {
                    $(this).attr("background", "orange")
                }
            });
        });
    });
</script>


<body>
<div class="container">
<h3 class=" text-center">Secure Social Net - <i>built on Matrix</i></h3>
<div class="messaging">
      <div class="inbox_msg">
        <div class="inbox_people">
          <div class="headind_srch">
            <div class="recent_heading">
              <h4>Recent</h4>
            </div>
            <div class="srch_bar">
              <div class="stylish-input-group">
                <input type="text" class="search-bar"  placeholder="Search" >
                <span class="input-group-addon">
                <button type="button"> <i class="fa fa-search" aria-hidden="true"></i> </button>
                </span> </div>
            </div>
          </div>
          <div class="rooms_list" href="{% url 'chat_window' %}">

              {% for room in rooms %}
                <div class="active_room chat_list " id="{{ room }}">
                  <div class="chat_people">
                    <div class="chat_img"> <img src="https://ptetutorials.com/images/user-profile.png" alt="sunil"> </div>
                    <div class="chat_ib" >
                      <h5 class="room_name" id="{{ room }}"> {{ room }} <span class="msg_count">New msg count</span></h5>
                      <p></p>
                    </div>
                  </div>
                </div>
              {% endfor %}

            <div class="chat_list">
              <div class="chat_people">
                <div class="chat_img"> <img src="https://ptetutorials.com/images/user-profile.png" alt="sunil"> </div>
                <div class="chat_ib">
                  <h5>Sunil Rajput <span class="chat_date">Dec 25</span></h5>
                  <p>Test, which is a new approach to have all solutions
                    astrology under one roof.</p>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="mesgs">

          {% include 'matrix/msg_history.html' %}

          <div class="type_msg input_msg_write">
            <form method="post">
                {% csrf_token %}
                {% render_field form.typedtext class="write_msg" id="chat-input" type="text" placeholder="say anything" autofocus="true" %}
            </form>
            <form>


            </form>
          </div>
        </div>
      </div>


      <p class="text-center top_spac"> Design by <a target="_blank" href="#">Sunil Rajput</a></p>

    </div>
</div>
</body>
</html>